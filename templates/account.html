{% extends 'base.html' %} {% load static %} {% block style %}

{% endblock %} {% block modal %}

<!-- Edit Address Modal -->
<div
  class="modal fade"
  id="editAddressModal"
  tabindex="-1"
  aria-labelledby="editAddressModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h4>Billing Details</h4>
        <form id="editAddressForm" method="post">
            {% csrf_token %}
            <div class="mb-3">
              <label for="editFirstName" class="form-label">First Name</label>
              <input type="text" class="form-control" id="editFirstName" placeholder="John" name="first_name"/>
            </div>
            <div class="mb-3">
              <label for="editLastName" class="form-label">Last Name</label>
              <input type="text" class="form-control" id="editLastName" placeholder="Doe" name="last_name" />
            </div>
            <div class="mb-3">
              <label for="editEmail" class="form-label">Email</label>
              <input type="email" class="form-control" id="editEmail" placeholder="email@example.com" name="email" />
            </div>
            <div class="mb-3">
              <label for="editAddress" class="form-label">Address</label>
              <input type="text" class="form-control" id="editAddress" placeholder="1234 Main St"  name="address"/>
            </div>
            <div class="mb-3">
              <label for="editAddress2" class="form-label">Address 2</label>
              <input type="text" class="form-control" id="editAddress2" placeholder="Apartment, studio, or floor" name="address2" />
            </div>
            <div class="mb-3">
              <label for="editCountry" class="form-label">Country</label>
              <select class="form-select" id="editCountry" name="country">
                <option value="" selected>Choose...</option>
                <option value="US">United States</option>
                <option value="CA">Canada</option>
                <option value="GB">United Kingdom</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editState" class="form-label">State</label>
              <select class="form-select" id="editState" name="state">
                <option value="" selected>Choose...</option>
                <option value="CA">California</option>
                <option value="TX">Texas</option>
                <option value="NY">New York</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editZip" class="form-label" >Zip</label>
              <input type="text" class="form-control" name="zip_code" id="editZip" placeholder="12345" />
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input"  name="default" type="checkbox" id="default" />
              <label class="form-check-label" for="default">
                Save as Default
              </label>
            </div>
          
          
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Close
        </button>
        <button
          type="submit"
          class="btn btn-primary"
        >
          Save changes
        </button></form>
      </div>
    </div>
  </div>
</div>

<!-- Add Address Modal -->
<div
  class="modal fade"
  id="addAddressModal"
  tabindex="-1"
  aria-labelledby="addAddressModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addAddressModalLabel">Add New Address</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h4>Billing Details</h4>
        <form id="addAddressForm" method="post" action="{% url 'add_address' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="addFirstName" class="form-label">First Name</label>
            <input
              type="text"
              class="form-control"
              id="addFirstName"
              name="first_name"
              placeholder="John"
            />
          </div>
          <div class="mb-3">
            <label for="addLastName" class="form-label">Last Name</label>
            <input
              type="text"
              class="form-control"
              id="addLastName"
              name="last_name"
              placeholder="Doe"
            />
          </div>
          <div class="mb-3">
            <label for="addEmail" class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              id="addEmail"
              name="email"
              placeholder="email@example.com"
            />
          </div>
          <div class="mb-3">
            <label for="addAddress" class="form-label">Address</label>
            <input
              type="text"
              class="form-control"
              id="addAddress"
              name="address"
              placeholder="1234 Main St"
            />
          </div>
          <div class="mb-3">
            <label for="addAddress2" class="form-label">Address 2</label>
            <input
              type="text"
              class="form-control"
              id="addAddress2"
              name="address2"
              placeholder="Apartment, studio, or floor"
            />
          </div>
          <div class="mb-3">
            <label for="addCountry" class="form-label">Country</label>
            <select class="form-select" id="addCountry" name="country">
              <option value="" selected>Choose...</option>
              <option value="US">United States</option>
              <option value="CA">Canada</option>
              <option value="GB">United Kingdom</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="addState" class="form-label">State</label>
            <select class="form-select" id="addState" name="state">
              <option value="" selected>Choose...</option>
              <option value="CA">California</option>
              <option value="TX">Texas</option>
              <option value="NY">New York</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="addZip" class="form-label">Zip</label>
            <input
              type="text"
              class="form-control"
              id="addZip"
              name="zip_code"
              placeholder="12345"
            />
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="addDefault" name="default" />
            <label class="form-check-label" for="addDefault">
              Save as Default
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          Close
        </button>
        <button
          type="button"
          class="btn btn-primary"
          onclick="document.getElementById('addAddressForm').submit();"
        >
          Save changes
        </button>
      </div>
    </div>
  </div>
</div>


{% endblock %} {% block body %} 
        
   
<br><br>
<div class="container account-container">
   {% include "components/messages.html" with messages=messages %} 
  

  <h1 class="text-center mb-5">My Account



  </h1>
  <div class="row">
    <div class="col-md-3 mb-3 custom-menu">
      <ul
        class="nav flex-column nav-pills"
        id="v-pills-tab"
        role="tablist"
        aria-orientation="vertical"
      >
      {% comment %} <li class="nav-item">
        <a
          class="nav-link"
          id="v-pills-messages-tab"
          data-toggle="pill"
          href="#v-pills-messages"
          role="tab"
          aria-controls="v-pills-messages"
          aria-selected="false"
          onclick="markAllMessagesAsRead()"
        >
          Messages
          {% if newMsj %}
          <span class="badge badge-danger">‚óè</span>
          {% endif %}
        </a>
      </li> {% endcomment %}

        <li class="nav-item">
          <a
            class="nav-link"
            id="v-pills-addresses-tab"
            data-toggle="pill"
            href="#v-pills-addresses"
            role="tab"
            aria-controls="v-pills-addresses"
            aria-selected="false"
            >Addresses</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="v-pills-orders-tab"
            data-toggle="pill"
            href="#v-pills-orders"
            role="tab"
            aria-controls="v-pills-orders"
            aria-selected="false"
            >Orders</a
          >
        </li>

        <li class="nav-item">
          <a
            class="nav-link"
            id="v-pills-settings-tab"
            data-toggle="pill"
            href="#v-pills-settings"
            role="tab"
            aria-controls="v-pills-settings"
            aria-selected="false"
            >Settings</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="v-pills-wishlist-tab"
            data-toggle="pill"
            href="#v-pills-wishlist"
            role="tab"
            aria-controls="v-pills-wishlist"
            aria-selected="false"
            >Wishlist</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="v-pills-notifications-tab"
            data-toggle="pill"
            href="{% url 'account_logout' %}"
            role="tab"
            aria-selected="false"

            h
            >Log out</a
          >
        </li>
      </ul>
    </div>
    <div class="col-md-9">
      <div class="tab-content" id="v-pills-tabContent">
        <!-- Addresses Tab -->
        <div
          class="tab-pane fade"
          id="v-pills-addresses"
          role="tabpanel"
          aria-labelledby="v-pills-addresses-tab"
        >
          <h3>Addresses</h3>
          <div class="address-list">
            {% for x in addresses %}
            <!-- Example Address -->
            <div class="card mb-3">
              <div class="card-body">
                <h5 class="card-title">
                  {% if x.default %} Primary Address {% else %} Secondary Address{% endif %}
                </h5>
                <p class="card-text">{{ x.address | slice:":20" }}</p>
                <p class="card-text">{{ x.country }}, {{ x.state }}, {{ x.zip_code }} </p>
                <p class="card-text"><strong>Status:</strong> {{x.status}}</p>
                {% if active_order.address == x  %}
                <strong>This address is assign to the cureent order</strong> <br>
                {% endif %}
                
                {% if x.shipping_price %}
              
                <p class="card-text"><strong>Fee:</strong> $5.00</p>

                {% endif %}
                <a href="#" class="btn btn-info"
       onclick="openEditModal(
           '{{ x.id }}',
           '{{ x.first_name }}',
           '{{ x.last_name }}',
           '{{ x.email }}',
           '{{ x.address }}',
           '{{ x.address2 }}',
           '{{ x.country }}',
           '{{ x.state }}',
           '{{ x.zip_code }}',
           {{ address.default|yesno:"true,false" }},
       )">
       Edit
          </a>

                {% if not x.default %}
                <a
                  href="{% url 'default-address' x.id %}"
                  class="btn btn-info"
                  >Define as Default</a
                >
                {% endif %}
                <a
                  href="{% url 'delete-address' x.id %}"
                  class="btn btn-danger"
                  >Delete</a
                >
                
                {% if not active_order.address == x  %}
                
                
                <form method="post" action="">
                  {% csrf_token %}
                  <input type="hidden" value="{{ x.id }}" name="assign_address">
                <button type="submit" class="btn btn-primary mt-2">Assign as address of the current order</button>
              </form>
              {%  elif not active_order.addree and x.default %} 
              
              {% endif %}
              

              </div>
            </div>

            {% endfor %}
          </div>

          <button class="btn btn-success m-3" onclick="openAddModal()">
            Add New Address
          </button>
        </div>

        <!-- Orders Tab -->
        <div
          class="tab-pane fade"
          id="v-pills-orders"
          role="tabpanel"
          aria-labelledby="v-pills-orders-tab"
        >
          <h3>Orders</h3>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Date</th>
                <th>Status</th>
                <th>Total</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Example Order -->

              {% for x in Orders %}
              <tr>
                <td>{{x.uuid}}</td>
                <td>Since {% if x.status == "PENDING" %}
                  {{ x.created_at }}
                {% elif x.status == "PROCESSING" %}
                  {{ x.payed_at|default:"N/A" }}
                {% elif x.status == "SHIPPED" %}
                  {{ x.shipped_at|default:"N/A" }}
                {% elif x.status == "DELIVERED" %}
                  {{ x.delivered_at|default:"N/A" }}
                {% elif x.status == "CANCELLED" %}
                  Order Cancelled
                {% else %}
                  Unknown Status
                {% endif %}</td>
                <td>{% if x.status == "PENDING" %}Active order {% else %}{{x.status}} {% endif %}</td>
                <td>${{x.total}}</td>
                <td>
                  <a href="{% url 'custom_order' x.uuid %}" class="btn btn-info btn-sm">View</a>
                </td>
              </tr>

              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Messages Tab -->
        {% comment %} <div
          class="tab-pane fade"
          id="v-pills-messages"
          role="tabpanel"
          aria-labelledby="v-pills-messages-tab"
        >
          <h3>Messages</h3>
          <ul class="list-group">
            <!-- Example Message -->
            {% for message in messages2 %}
            <li class="list-group-item {% if not message.is_read %}font-weight-bold{% endif %}">
              <h5>{{ message.title }}</h5>
              <p>{{ message.message }}</p>
              <small class="text-muted">Received on {{ message.created_at }}</small>
            </li>
            {% endfor %}
          </ul>
        </div> {% endcomment %}

        <!-- Settings Tab -->
        <div
          class="tab-pane fade"
          id="v-pills-settings"
          role="tabpanel"
          aria-labelledby="v-pills-settings-tab"
        >
        <div class="container mt-5">
          <h2 class="mb-4">Account Settings</h2>
          <div class="list-group list-group-flush">
              <a href="{% url 'account_email' %}" class="list-group-item list-group-item-action">
                  <i class="bi bi-envelope"></i> Manage Email Addresses
              </a>
              <a href="{% url 'account_change_password' %}" class="list-group-item list-group-item-action">
                  <i class="bi bi-key"></i> Change Password
              </a>
              <a href="{% url 'account_set_password' %}" class="list-group-item list-group-item-action">
                  <i class="bi bi-shield-lock"></i> Set a Password (for social accounts)
              </a>
              
              <a href="{% url 'socialaccount_connections' %}" class="list-group-item list-group-item-action">
                Manage Social Accounts
            </a>
            {% comment %} <a href="{% url 'account_inactive' %}" class="list-group-item list-group-item-action btn-danger" style="background: #8b0000">
                  <i class="bi bi-x-circle"></i> Deactivate the account
              </a> {% endcomment %}
              
          </div>
      </div>
        </div>

        <!-- Wishlist Tab -->
        <div
          class="tab-pane fade"
          id="v-pills-wishlist"
          role="tabpanel"
          aria-labelledby="v-pills-wishlist-tab"
        >
          <h3>Wishlist</h3>

          <table class="table table-bordered">
            <thead class="thead-light">
              <tr>
                <th scope="col">Produit</th>
                <th scope="col">Image</th>
                <th scope="col">Prix</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for item in wishlist %}
              <tr>
                <td>{{ item.title }}</td>
                <td>
                  <img
                    src="{{ item.image.url }}"
                    class="product-img"
                    alt="{{ item.title }}"
                    height="50"
                  />
                </td>
                <td>${{ item.price }}</td>
                <td>
                  <div class="input-group">
                      
                    <a
                    href="{% url 'move_to_cart' item.id  %}"
                    class=""
                    >Move to cart</a
                  >
                  <br />
                  <a
                    href="{% url 'remove_from_wishlist' item.id  %}"
                    class=""
                    >Remove from wishlist</a
                  >
                    
                  </div>
                </td>
      
               
      
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center">Your Wishlist is empty.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<br /><br />
{% endblock %} {% block js %}

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script type="text/javascript">
  function openEditModal(id, firstName, lastName, email, address, address2, country, state, zip, saveAsDefault) {
  document.getElementById("editFirstName").value = firstName;
  document.getElementById("editLastName").value = lastName;
  document.getElementById("editEmail").value = email;
  document.getElementById("editAddress").value = address;
  document.getElementById("editAddress2").value = address2;
  document.getElementById("editCountry").value = country;
  document.getElementById("editState").value = state;
  document.getElementById("editZip").value = zip;
  document.getElementById("default").checked = saveAsDefault;

  // Set the action URL with the address ID
  document.getElementById("editAddressForm").action = `/address/edit/${id}/`;

  $("#editAddressModal").modal("show");
}


function openAddModal() {
  document.getElementById("addFirstName").value = "";
  document.getElementById("addLastName").value = "";
  document.getElementById("addEmail").value = "";
  document.getElementById("addAddress").value = "";
  document.getElementById("addAddress2").value = "";
  document.getElementById("addCountry").value = "";
  document.getElementById("addState").value = "";
  document.getElementById("addZip").value = "";
  document.getElementById("addDefault").checked = false;
  $("#addAddressModal").modal("show");
}


  function saveEditAddress() {
    // Logic to save the edited address
    $("#editAddressModal").modal("hide");
  }

  function addNewAddress() {
    // Logic to add a new address
    $("#addAddressModal").modal("hide");
  }
</script>

<script>
   
  </script>

{% endblock %}
